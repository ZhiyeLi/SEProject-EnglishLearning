# API 接口文档

## 登录部分

| API 名                         | 返回类型                                                                                                                              | 输入参数信息                                                           | 功能描述                                                                                                                                                        |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| api/login                      | Null                                                                                                                                  | password，username                                                     | 向数据库提交用户名和用户密码，返回 short int 值表示登录状况：登录成功，用户名不存在，密码错误，数据库未连接，etc。<br>如果登录成功，更改本地登录状态值为 true。 |
| api/logout                     | Null                                                                                                                                  | Null                                                                   | 更改本地登录状态值为 false，并重新渲染整个网站页面。                                                                                                            |
| api/check_login                | bool                                                                                                                                  | Null                                                                   | 检查当前用户的登录状态，返回 bool 结果。变量从本地获取                                                                                                          |
| get/api/users/username         | varchar                                                                                                                               | null                                                                   | 获取用户名                                                                                                                                                      |
| get/api/users/password         | varchar                                                                                                                               | null                                                                   | 获取用户密码                                                                                                                                                    |
| get/api/users/nickname         | varchar                                                                                                                               | null                                                                   | 获取昵称                                                                                                                                                        |
| get/api/users/avatar           | varchar                                                                                                                               | null                                                                   | 获取头像地址                                                                                                                                                    |
| get/api/users/signature        | varchar                                                                                                                               | null                                                                   | 获取个性签名                                                                                                                                                    |
| post/api/auth/send-verify-code | {code:number(状态码 200 表成功，其他为错误), message:string(提示信息（如"验证码发送成功"或错误原因）)}                                | account：string（手机或邮箱账号）,type:'phone'/'email'（手机还是邮箱） | 发送验证码                                                                                                                                                      |
| post/api/auth/reset-password   | {code:number(状态码 200 表成功，其他为错误), message:string(提示信息（如"验证码发送成功"或错误原因）)}                                | account,type,verifycode,newpassword                                    | 重置密码                                                                                                                                                        |
| post/api/auth/login            | {code:number(状态码 200 表成功，其他为错误), message:string(提示信息（如"验证码发送成功"或错误原因）),data(用户信息包括 userInfo 等)} | {username:string,password:string}                                      | 登录                                                                                                                                                            |

## 计划时间表部分

| API 名                         | 返回类型                                                                                    | 输入参数信息                                                                                                                                                                           | 功能描述                                                     |
| ------------------------------ | ------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------ |
| GET /api/plans                 | Array<Plan>                                                                                 | startDate: string (YYYY-MM-DD 格式), endDate: string (YYYY-MM-DD 格式)                                                                                                                 | 获取指定时间范围内的所有计划，用于展示月度计划表和周计划     |
| GET /api/plans/today           | Array<Plan>                                                                                 | Null                                                                                                                                                                                   | 获取当日的所有计划，用于展示今日计划模块                     |
| GET /api/plans/:date           | Array<Plan>                                                                                 | date: string (YYYY-MM-DD 格式，作为路径参数)                                                                                                                                           | 获取指定日期的所有计划，用于计划管理弹窗                     |
| POST /api/plans                | Plan                                                                                        | Plan 对象: {date: string (YYYY-MM-DD), title: string, description: string, category: string, priority: string, startTime: string (HH:mm), endTime: string (HH:mm), completed: boolean} | 创建新的学习计划                                             |
| PUT /api/plans/:id             | Plan                                                                                        | id: number (路径参数), Plan 对象: {title: string, description: string, category: string, priority: string, startTime: string (HH:mm), endTime: string (HH:mm), completed: boolean}     | 更新指定 ID 的计划信息                                       |
| PUT /api/plans/:id/complete    | {success: boolean}                                                                          | id: number (路径参数), completed: boolean (请求体)                                                                                                                                     | 切换计划的完成状态，用于标记计划完成或取消完成               |
| DELETE /api/plans/:id          | {success: boolean}                                                                          | id: number (路径参数)                                                                                                                                                                  | 删除指定 ID 的计划                                           |
| DELETE /api/plans/batch        | {success: boolean, deletedCount: number}                                                    | date: string (YYYY-MM-DD 格式), ids: Array<number> (可选，如果提供则删除指定 ID 的计划，否则删除该日期的所有计划)                                                                      | 批量删除计划，用于清空某日的所有计划或删除多个选中的计划     |
| GET /api/plans/first-plan-date | {date: string}                                                                              | Null                                                                                                                                                                                   | 获取用户第一次添加计划的日期，用于限制时间追溯的起始时间     |
| GET /api/plans/statistics      | {totalPlans: number, completedPlans: number, completionRate: number, categoryStats: Object} | startDate: string (YYYY-MM-DD 格式, 可选), endDate: string (YYYY-MM-DD 格式, 可选)                                                                                                     | 获取计划统计信息，包括总计划数、已完成数、完成率和各分类统计 |

计划时间表补充说明：

1. 鉴权依赖：所有 API 均需用户认证，后端必须从 Session 中获取当前 userId，不可通过参数传递用户 ID。

2. 格式规范：日期字段统一为 YYYY-MM-DD，时间字段统一为 HH:mm (24 小时制)。

3. 业务逻辑验证：

   标题唯一性：同一用户在同一天内的 title 必须唯一（不区分大小写），后端保存/更新时需验证。

4. 排序规则：返回的计划列表必须按以下顺序排序：

   首要：未完成在前，已完成在后。

   次要：优先级（high → medium → low）。

   三级（可选）：按 startTime 排序，无时间的排最后。

5. 原子性建议：批量操作（如批量保存时涉及的删除旧计划+创建新计划）建议提供原子性操作支持。

6. 提醒功能：建议实现未列出的计划提醒 API 用于推送通知。

## 聊天和好友部分

| API 名                      | 返回类型             | 输入参数信息                   | 功能描述                                                                                                                                                       |
| --------------------------- | -------------------- | ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST api/sendMessage        | Boolean              | senderId 、receiverId、content | 向数据库提交聊天消息： 输入参数：发送者 ID、接收者 ID、消息内容                                                                                                |
| GET api/getMessageList      | Array<Message>       | senderId 、receiverId          | 获取指定好友的聊天记录：<br>1. 输入参数：当前用户 ID、好友 ID<br>2. 返回值：消息列表数组                                                                       |
| GET api/searchFriend        | Array<Friend>        | userId ,name                   | 搜索好友（用户名 / ID 模糊匹配）                                                                                                                               |
| POST api/sendFriendRequest  | Short Int            | senderId 、receiverId          | 1. 插入好友请求表（status=pending)；<br>2. 返回值：0 = 成功 / 1 = 已是好友 / 2 = 请求已存在                                                                    |
| GET api/getFriendRequests   | Array<FriendRequest> | userId                         | 获取未处理请求：<br>1. 查询好友请求表中 receiver_id 匹配且 status=pending 的记录；<br>2. 关联用户表获取请求者 user_name；<br>3. 返回请求列表，无数据返回空数组 |
| PUT api/acceptFriendRequest | Boolean              | userId 、requestId             | 接受好友请求：<br>1. 更新好友请求表 status=accepted；<br>2. 向好友关系表插入两条记录（user_id↔friend_id 互相关联）；<br>3. 返回 true = 成功 /false = 失败      |
| GET api/getFriendList       | Array<Friend>        | userId                         | 获取当前用户的好友列表：<br>1. 输入参数：当前用户 ID<br>2. 返回值：好友列表数组                                                                                |

## 注册部分

| API 名             | 返回类型 | 输入参数信息                        | 功能描述                                                               |
| ------------------ | -------- | ----------------------------------- | ---------------------------------------------------------------------- |
| api/register       | NULL     | username,password,email（均必填项） | 用户注册接口：创建新账户                                               |
| api/reset-password | NULL     | email                               | 用于忘记密码功能，用户通过输入唯一的邮箱验证身份，确认身份后可重置密码 |

## 单词打卡页面部分

| API 名                | 请求方式 | 返回类型                                                                                 | 输入参数信息                                                                                                                   | 功能描述                                   |
| --------------------- | -------- | ---------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------ |
| getUserWordProgress   | GET      | {typeId, passedCount, totalCount, passedWords[], lastPassedDate, consecutiveDays}        | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID)                                                                   | 获取用户在指定词汇类型下的打卡进度信息     |
| getWordTypeList       | GET      | Array<Object> [{id, name, description, color, icon, totalWords}]                         | 无                                                                                                                             | 获取系统中所有可用的词汇类型列表           |
| getWordsByType        | GET      | {words[], total, currentPage, pageSize, totalPages}                                      | typeId(string/必填/词汇类型 ID); page(number/可选/页码默认 1); pageSize(number/可选/每页数量默认 20)                           | 获取指定类型的单词列表（支持分页查询）     |
| markWordPassed        | POST     | {success, passedDate, newPassedCount}                                                    | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID); wordId(number/必填/单词 ID)                                      | 标记指定单词为已打卡状态                   |
| unmarkWordPassed      | POST     | {success, newPassedCount}                                                                | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID); wordId(number/必填/单词 ID)                                      | 取消指定单词的已打卡标记                   |
| createCheckInPlan     | POST     | {planId, typeId, wordsPerDay, remainingWords, daysNeeded, startDate, status}             | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID); wordsPerDay(number/必填/每日打卡数量 1-100)                      | 创建或更新用户的单词打卡计划               |
| getUserCheckInPlan    | GET      | {planId, typeId, wordsPerDay, remainingWords, daysNeeded, startDate, status}             | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID)                                                                   | 获取用户当前的打卡计划信息                 |
| updatePlanStatus      | PUT      | {success, status, updatedAt}                                                             | userId(string/必填/用户 ID); planId(string/必填/计划 ID); status(string/必填/状态：active 进行中、paused 暂停、completed 完成) | 更新打卡计划状态（暂停/继续/完成）         |
| getPassedWords        | GET      | Array<Object> [{id, word, translation, pronunciation, example, passedDate, reviewCount}] | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID)                                                                   | 获取用户已打卡的所有单词列表               |
| getSelectedWordType   | GET      | {typeId, selectedDate}                                                                   | userId(string/必填/用户 ID)                                                                                                    | 获取用户当前选择的词汇类型                 |
| setSelectedWordType   | POST     | {success, typeId, selectedDate}                                                          | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID)                                                                   | 设置用户选择的词汇类型                     |
| batchMarkWordsPassed  | POST     | {success, passedCount, failedWords[]}                                                    | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID); wordIds(Array<number>/必填/单词 ID 数组)                         | 批量标记多个单词为已打卡状态               |
| getWordDetail         | GET      | {id, word, translation, pronunciation, example, synonyms[], antonyms[], usageNotes}      | wordId(number/必填/单词 ID 路径参数)                                                                                           | 获取单词的详细信息（包括同义词、反义词等） |
| getTodayCheckInStatus | GET      | {todayCheckedCount, todayTarget, isCompleted, checkedWords[]}                            | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID)                                                                   | 获取用户今日的打卡完成情况                 |
| getCheckInStatistics  | GET      | {totalDays, consecutiveDays, totalWords, averagePerDay, lastCheckInDate}                 | userId(string/必填/用户 ID); typeId(string/必填/词汇类型 ID)                                                                   | 获取用户的打卡统计信息                     |

## 题库部分

| API 名                              | 请求方式 | 返回类型                           | 输入参数信息                                                                | 功能描述                                         |
| ----------------------------------- | -------- | ---------------------------------- | --------------------------------------------------------------------------- | ------------------------------------------------ |
| GET/api/questions                   | GET      | 题目列表、总数、分页信息           | page, limit, type, difficulty, status, courseId, keyword, includeVocabulary | 获取题目列表（支持分页、多条件筛选及关键词搜索） |
| GET/api/questions/:id               | GET      | 题目完整信息（含题干、选项、解析） | id (路径参数)                                                               | 根据 ID 获取单个题目的详细信息                   |
| POST/api/questions/:id/submit       | POST     | 批改结果、正确率、解析             | questionId, answers[], timeSpent                                            | 提交用户答题结果，返回系统自动批改数据           |
| POST/api/questions/:id/favorite     | POST     | 收藏状态                           | questionId                                                                  | 切换题目的收藏或取消收藏状态                     |
| GET/api/questions/statistics        | GET      | 今日做题数、总正确率、累计数据     | userId (从 token 获取)                                                      | 获取当前用户的做题统计数据                       |
| GET/api/questions/wrong             | GET      | 错题列表、统计信息                 | page, limit, type                                                           | 获取用户的错题记录列表                           |
| POST/api/questions/wrong/:id/master | POST     | 操作结果                           | questionId                                                                  | 将指定错题标记为“已掌握”，从错题推荐中移除       |
| POST/api/questions/plan             | POST     | 计划项信息                         | questionId, planDate, note                                                  | 将指定题目加入用户的学习计划                     |
| GET/api/courses                     | GET      | 课程列表（含章节信息）             | 无                                                                          | 获取所有课程及其章节结构的列表                   |
| GET/api/courses/:id/questions       | GET      | 关联题目列表                       | courseId, chapterId                                                         | 获取特定课程或章节下的关联题目                   |
| GET/api/vocabulary/user             | GET      | 用户生词列表                       | userId (从 token 获取)                                                      | 获取用户的生词本数据                             |
| POST/api/vocabulary/add             | POST     | 添加结果                           | word, translation, sourceQuestionId                                         | 添加新的生词到生词本，支持关联来源题目           |
| GET/api/vocabulary/questions        | GET      | 包含生词的题目列表                 | userId (从 token 获取)                                                      | 检索包含用户生词本中单词的题目                   |

题库部分补充说明：

1. 认证与鉴权：系统实施严格的身份验证，所有 API 必须在请求头（Header）中携带 JWT Token。服务端将从 Token 中解析 userId，以确保用户数据的隔离性与操作的安全性。

2. 分页规范：所有列表类查询接口统一使用 standard 分页参数 page（页码）和 limit（每页数量）。响应数据结构中包含 total（总记录数）、pages（总页数）及 currentPage（当前页）。

3. 复杂筛选：/api/questions 接口具备高级筛选能力，type（题型）和 difficulty（难度）参数支持数组格式（逗号分隔），允许前端实现多选组合过滤。

4. 数据采集：答题提交接口不仅处理判分，还需记录用户的具体答案、消耗时间（timeSpent）及正误状态，这些数据是生成学习报告和后续个性化推荐算法的基础。

5. 关联逻辑：题目与课程体系通过 relatedCourse 和 relatedChapter 字段深度绑定，支持细粒度到章节的题目检索。

6. 业务联动：生词本模块与做题模块高度集成，新增生词时强制或可选记录 sourceQuestionId，以便用户复习单词时能回溯到具体的语境和题目。

---

# 数据库表结构设计

## 用户表

| 表项          | 类型         | 描述                                                                                    |
| ------------- | ------------ | --------------------------------------------------------------------------------------- |
| user_id       | int          | 用户唯一身份 id，做自增主键                                                             |
| user_name     | varchar(50)  | 用户名，允许相同                                                                        |
| user_password | varchar(30)  | 用户密码                                                                                |
| user_email    | varchar(70)  | 用于账号创建以及找回密码                                                                |
| avatar        | varchar(255) | 头像 URL                                                                                |
| user_status   | ENUM         | 用户状态：('沉迷学习','忙','摸鱼','闭关','美滋滋','裂开','疲惫','emo','bot','元气满满') |
| signature     | varchar(200) | 个性签名                                                                                |
| streak        | int          | 连续打卡天数                                                                            |
| created_at    | TIMESTAMP    | 创建时间 (默认当前时间)                                                                 |
| updated_at    | TIMESTAMP    | 更新时间 (默认当前时间，更新时自动更新)                                                 |

## 学习计划表

| 表项         | 类型                          | 描述                                    |
| ------------ | ----------------------------- | --------------------------------------- |
| id           | BIGINT (AUTO_INCREMENT)       | 主键 ID                                 |
| user_id      | int                           | 关联用户 ID (非空)                      |
| date         | DATE                          | 计划日期 (非空)                         |
| title        | VARCHAR(255)                  | 计划标题 (非空)                         |
| description  | TEXT                          | 计划描述                                |
| category     | VARCHAR(50)                   | 分类 (非空，默认 '其他')                |
| priority     | ENUM('low', 'medium', 'high') | 优先级 (非空，默认 'medium')            |
| start_time   | TIME                          | 开始时间                                |
| end_time     | TIME                          | 结束时间                                |
| if_completed | BOOLEAN                       | 是否完成 (非空，默认 FALSE)             |
| created_at   | TIMESTAMP                     | 创建时间 (默认当前时间)                 |
| updated_at   | TIMESTAMP                     | 更新时间 (默认当前时间，更新时自动更新) |

学习计划表补充说明：

1. 依赖关系：user_id 字段逻辑上关联到用户表（虽未列出用户表定义，但后端需从 Session 获取该值）。
2. 唯一性约束 (Unique Key)：
   约束名：uk_user_date_title
   字段组合：(user_id, date, title)
   作用：数据库层面强制保证同一用户同一天内标题不重复。
3. 索引优化 (Indexes)：
   idx_user_date (user_id, date)：加速查询某用户某日的计划。
   idx_user_date_range (user_id, date)：加速查询某用户时间范围内的计划。
4. 字符集：建议使用 utf8mb4。
5. 未来扩展性（参考）：
   若支持提醒，可增加 reminder_time 字段或创建 plan_reminders 表。
   若支持复杂重复计划，可增加 recurrence_rule 字段或创建 recurring_plans 表。
   若支持自定义分类，需将 category 改为 category_id 并新建 plan_categories 表。

## 好友表

| 表项        | 类型 | 描述                          |
| ----------- | ---- | ----------------------------- |
| relation_id | int  | 关系 ID，自增主键             |
| user_id     | int  | 主用户 ID，关联用户表 user_id |
| friend_id   | int  | 好友 ID，关联用户表 user_id   |

## 聊天消息表

| 表项        | 类型      | 描述                          |
| ----------- | --------- | ----------------------------- |
| message_id  | int       | 消息 ID，自增主键             |
| sender_id   | int       | 发送者 ID，关联用户表 user_id |
| receiver_id | int       | 接收者 ID，关联用户表 user_id |
| content     | text      | 消息内容                      |
| if_read     | boolean   | 是否已读                      |
| sent_at     | TIMESTAMP | 发送时间                      |

## 好友请求表

| 表项        | 类型        | 描述                                                |
| ----------- | ----------- | --------------------------------------------------- |
| request_id  | int         | 请求 ID，自增主键                                   |
| sender_id   | int         | 发送者 ID，关联用户表 user_id                       |
| receiver_id | int         | 接收者 ID，关联用户表 user_id                       |
| status      | varchar(10) | 请求状态（pending/accepted/rejected，默认 pending） |

## 通用单词属性表（words）

_所有用户共享_
| 表项 | 类型 | 描述 |
|-------------|----------|----------------------------------------|
| word_id | INT | 单词唯一标识，不得为空。主键 |
| part_of_speech | ENUM | 词性 |
| word | VARCHAR(80) | 单词拼写 |
| phonetic | VARCHAR(100) | 音标 |
| definition | TEXT | 中文释义 |
| example | TEXT | 英文例句 |
| type_id | int | 词汇类型 id |
| synonyms | json | 同义词数组 |
| antonyms | json | 反义词数组 |
| usage_notes | text | 用法说明 |

## 书籍表（books）

| 表项        | 类型         | 描述                         |
| ----------- | ------------ | ---------------------------- |
| book_id     | INT          | 书籍唯一 ID（主键）          |
| book_name   | VARCHAR(100) | 单词书名称                   |
| book_cover  | VARCHAR(300) | 书籍封面 url（如有需要添加） |
| total_words | INT          | 书籍总单词数                 |
| create_time | DATETIME     | 该书籍添加时间               |
| type_id     | int          | 词汇类型 id                  |

## 单词-书籍关联表（book_word_relation）

| 表项        | 类型 | 描述                     |
| ----------- | ---- | ------------------------ |
| relation_id | int  | 关联 id（主键）          |
| book_id     | INT  | 书籍 ID                  |
| word_id     | INT  | 单词 ID（关联 words 表） |
| word_order  | int  | 单词顺序                 |

## 用户单词进度表（user_word_progress）

_可跨书描述用户是否掌握单词（已经背过的单词之后新书就默认掌握）_
| 表项 | 类型 | 描述 |
|------------------|----------|----------------------------------------|
| progess_id | int | 进度 id |
| user_id | INT | 关联用户表 |
| word_id | INT | 关联单词表 |
| stage | TINYINT | 学习阶段(0=未学、1=新学、2=复习、3=掌握)|
| last_review_time | DATATIME | 上次复习时间 |
| next_review_time | DATATIME | 下次复习时间 |
| review_count | INT | 复习次数 |

## 每日打卡记录表（daily_study_record）

| 表项         | 类型 | 描述           |
| ------------ | ---- | -------------- |
| user_id      | INT  | 关联用户表     |
| study_date   | DATE | 打卡日期       |
| new_words    | INT  | 当日新学单词数 |
| review_words | INT  | 当日复习单词数 |
| total_words  | INT  | 当日学习单词数 |
| streak       | INT  | 连续打卡天数   |

## 词汇类型表（word_types）

| 表项    | 类型 | 描述                |
| ------- | ---- | ------------------- |
| type_id | int  | 词汇类型 id（主键） |
| name    | text | 类型名称            |

## 题库部分数据库表结构（Markdown 表格版）

### 1. 题目表（questions）

| 表项 (Field) | 类型         | 描述 (含义与约束)                                                          |
| ------------ | ------------ | -------------------------------------------------------------------------- |
| id           | VARCHAR(36)  | 题目唯一标识 (PRIMARY KEY)                                                 |
| type         | ENUM         | 题型：listening, reading, writing, grammar, vocabulary (NOT NULL)          |
| difficulty   | ENUM         | 难度：beginner, cet4-6, postgraduate, toefl-ielts, professional (NOT NULL) |
| title        | VARCHAR(255) | 题目标题 (NOT NULL)                                                        |
| preview      | TEXT         | 题目预览内容                                                               |
| content      | TEXT         | 题目完整内容，如文章正文或音频脚本 (NOT NULL)                              |
| audio_url    | VARCHAR(500) | 听力音频 URL，仅听力题使用                                                 |
| tags         | JSON         | 标签数组                                                                   |

### 2. 小题表（question_items）

| 表项 (Field)  | 类型        | 描述 (含义与约束)                    |
| ------------- | ----------- | ------------------------------------ |
| id            | VARCHAR(36) | 小题唯一标识 (PRIMARY KEY)           |
| question_id   | VARCHAR(36) | 所属题目 ID (FOREIGN KEY, NOT NULL)  |
| question_text | TEXT        | 小题题干 (NOT NULL)                  |
| question_type | ENUM        | 题型：choice, essay, fill (NOT NULL) |
| options       | JSON        | 选项数组，用于选择题                 |
| answer        | VARCHAR(50) | 正确答案 (NOT NULL)                  |
| explanation   | TEXT        | 答案解析                             |
| order_num     | INT         | 大题内部排序顺序 (NOT NULL)          |

### 3. 做题记录表（user_question_records）

| 表项 (Field)      | 类型        | 描述 (含义与约束)               |
| ----------------- | ----------- | ------------------------------- |
| id                | VARCHAR(36) | 记录唯一标识 (PRIMARY KEY)      |
| user_id           | int         | 用户 ID (FOREIGN KEY, NOT NULL) |
| question_id       | VARCHAR(36) | 题目 ID (FOREIGN KEY, NOT NULL) |
| status            | ENUM        | 状态：not-done, done (NOT NULL) |
| last_result       | ENUM        | 最近一次结果：correct, wrong    |
| last_attempt_date | DATETIME    | 最近答题时间                    |
| correct_count     | INT         | 正确次数 (DEFAULT 0)            |
| wrong_count       | INT         | 错误次数 (DEFAULT 0)            |
| is_favorited      | BOOLEAN     | 是否收藏 (DEFAULT FALSE)        |

### 4. 答题详情表（user_answer_details）

| 表项 (Field)     | 类型        | 描述 (含义与约束)                         |
| ---------------- | ----------- | ----------------------------------------- |
| id               | VARCHAR(36) | 答案记录 ID (PRIMARY KEY)                 |
| record_id        | VARCHAR(36) | 关联的答题记录 ID (FOREIGN KEY, NOT NULL) |
| question_item_id | VARCHAR(36) | 小题 ID (FOREIGN KEY, NOT NULL)           |
| user_answer      | TEXT        | 用户填写的答案 (NOT NULL)                 |
| is_correct       | BOOLEAN     | 是否正确 (NOT NULL)                       |
| time_spent       | INT         | 答题耗时，单位秒                          |
| answered_at      | DATETIME    | 答题时间 (NOT NULL)                       |

### 5. 课程表（courses）

| 表项 (Field) | 类型         | 描述 (含义与约束)          |
| ------------ | ------------ | -------------------------- |
| id           | VARCHAR(36)  | 课程唯一标识 (PRIMARY KEY) |
| name         | VARCHAR(255) | 课程名称 (NOT NULL)        |
| description  | TEXT         | 课程描述                   |
| created_at   | DATETIME     | 创建时间 (NOT NULL)        |

### 6. 生词表（user_vocabulary）

| 表项 (Field)       | 类型         | 描述 (含义与约束)               |
| ------------------ | ------------ | ------------------------------- |
| id                 | VARCHAR(36)  | 生词记录 ID (PRIMARY KEY)       |
| user_id            | VARCHAR(36)  | 用户 ID (FOREIGN KEY, NOT NULL) |
| word_id            | int          | 单词 ID（关联 words 表）        |
| translation        | VARCHAR(255) | 翻译或释义                      |
| source_question_id | VARCHAR(36)  | 来源题目 ID (FOREIGN KEY)       |
| if_mastered        | BOOLEAN      | 是否已掌握 (DEFAULT FALSE)      |
| created_at         | DATETIME     | 添加时间 (NOT NULL)             |

题库表部分补充说明：

1. 主键策略：为解决分布式环境下的 ID 冲突问题并提升安全性，所有表的主键统一采用 UUID (VARCHAR(36))，而非传统的自增 ID。

2. 结构设计：采用“主题-小题”分离设计模式，questions 表存储题干背景（如文章），question_items 表存储具体问题（如文章后的选择题），以完美支持“一题多问”场景。

3. 数据粒度：答题记录分为两个维度：user_question_records 记录题目维度的宏观状态（收藏、总体正确率），而 user_answer_details 记录小题维度的微观数据（具体选项、单题耗时），便于精细化分析。

4. JSON 应用：利用 MySQL 5.7+ 或 PostgreSQL 的 JSON 特性，将 options（选项）、highlight_words（高亮词）、chapters（章节）等非关系型复杂数据直接以 JSON 类型存储，简化表结构设计。

5. 索引优化：

   questions 表：对 type, difficulty, related_course_id 建立索引以优化筛选性能。

   user_question_records 表：建议在 (user_id, question_id) 上建立联合唯一索引，防止重复记录。

   user_vocabulary 表：建议在 (user_id, word) 上建立联合唯一索引，避免生词重复添加。

6. 数据维护：建议在生产环境中为核心业务表添加 deleted_at 字段，采用软删除机制，保留历史数据以供后续的数据挖掘与分析使用。
